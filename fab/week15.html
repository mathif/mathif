<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>week-15</title>
    <link type="text/css" rel="stylesheet" href="assets/css/bootstrap.css"/>
    <link type="text/css" rel="stylesheet" href="assets/css/bootstrap-responsive.css"/>
    <link type="text/css" rel="stylesheet" href="assets/css/pilcrow.css"/>
    <link type="text/css" rel="stylesheet" href="assets/css/hljs-github.min.css"/>
    <link type="text/css" rel="stylesheet" href="assets/css/style.css"/>
    <style>
    body {
      background: url('assets/img/textured_paper.png') repeat top left;
      background-color: #f6f6f6;
    }
    </style>
  </head>
<body>

  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span3"><ul class="nav nav-list">
    <li class="sidebar-header-1"><a href="#week-15-networking-and-communications-may-11-">Week 15 : Networking and communications (May 11)</a></li>
    <li class="sidebar-header-2"><a href="#assignment-">Assignment :</a></li>
    <li class="sidebar-header-2"><a href="#rx-tx-communication">Rx Tx Communication</a></li>
    <li class="sidebar-header-3"><a href="#programming-step">Programming step</a></li>
    <li class="sidebar-header-4"><a href="#files">Files</a></li>
    <li class="sidebar-header-3"><a href="#asynchronus">Asynchronus</a></li>
    <li class="sidebar-header-4"><a href="#files">Files</a></li>
    <li class="sidebar-header-2"><a href="#spi">SPI</a></li>
    <li class="sidebar-header-3"><a href="#mrf89xa">MRF89XA</a></li>
</ul>
      </div>
      <div class="span9 main"><h1 id="week-15-networking-and-communications-may-11-"><a class="header-link" href="#week-15-networking-and-communications-may-11-"></a>Week 15 : Networking and communications (May 11)</h1>
<h2 id="assignment-"><a class="header-link" href="#assignment-"></a>Assignment :</h2>
<p>Design and build a wired or wireless network connecting at least two processors.</p>
<hr>
<h2 id="rx-tx-communication"><a class="header-link" href="#rx-tx-communication"></a>Rx Tx Communication</h2>
<p>This week i would like to do transmission reciever communication between my LCD board and FTDI board.</p>
<p>Here iam planning to do when i press the button in FTDI Board ,the message which i would like to display should be appear in LCD Display.</p>
<center><img src="img/w15/n.lcd.1.jpeg" width= "800"/></center>


<h3 id="programming-step"><a class="header-link" href="#programming-step"></a>Programming step</h3>
<p>First i did compile the program and did upload to FTDI Board using Arduino. </p>
<pre class="hljs"><code><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SoftwareSerial.h&gt;</span></span>
<span class="hljs-built_in">SoftwareSerial</span> mySerial(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);

<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> buttonPin = <span class="hljs-number">6</span>;    
<span class="hljs-keyword">int</span> buttonState = <span class="hljs-number">0</span>;

<span class="hljs-keyword">void</span> <span class="hljs-built_in">setup</span>() {
  mySerial.<span class="hljs-built_in">begin</span>(<span class="hljs-number">9600</span>);
  <span class="hljs-comment">// initialize the pushbutton pin as an input:</span>
  <span class="hljs-built_in">pinMode</span>(buttonPin, <span class="hljs-literal">INPUT</span>);
  <span class="hljs-built_in">digitalWrite</span>(buttonPin,<span class="hljs-literal">HIGH</span>);
}


<span class="hljs-keyword">void</span> <span class="hljs-built_in">loop</span>() {

  buttonState = <span class="hljs-built_in">digitalRead</span>(buttonPin);
  <span class="hljs-built_in">if</span> (buttonState == <span class="hljs-literal">LOW</span>) {
    mySerial.<span class="hljs-built_in">print</span>(<span class="hljs-string">'0'</span>);
    <span class="hljs-built_in">delay</span>(<span class="hljs-number">100</span>),
    mySerial.<span class="hljs-built_in">print</span>(<span class="hljs-string">'1'</span>);
    <span class="hljs-built_in">delay</span>(<span class="hljs-number">100</span>);

    }
}</code></pre><p>next was about clone program,did compile the program first, Rx and Tx pins defined as 7th pin and 6th pin respectively.My aim is when i press button message should get printed,when button is off message shoud disappear,for that i did apply &quot;if loop condition&quot;,so when condition satifies the message will print,in other case i did set another condition as print space 16 times,this how i did code.</p>
<pre class="hljs"><code><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SoftwareSerial.h&gt;</span></span>
<span class="hljs-built_in">SoftwareSerial</span> mySerial(<span class="hljs-number">7</span>,<span class="hljs-number">6</span>);

<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;LiquidCrystal.h&gt;</span> </span>
<span class="hljs-built_in">LiquidCrystal</span> LCD(<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>); 

<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ledPin = <span class="hljs-number">8</span> ;   

<span class="hljs-keyword">char</span> data;

<span class="hljs-keyword">void</span> <span class="hljs-built_in">setup</span>() {
  <span class="hljs-comment">// initialize</span>
  LCD.<span class="hljs-built_in">begin</span>(<span class="hljs-number">16</span>,<span class="hljs-number">2</span>);
  LCD.<span class="hljs-built_in">setCursor</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
  LCD.<span class="hljs-built_in">print</span>(<span class="hljs-string">"Welcome to ooty"</span>);

  <span class="hljs-built_in">pinMode</span>(ledPin, <span class="hljs-literal">OUTPUT</span>);
  mySerial.<span class="hljs-built_in">begin</span>(<span class="hljs-number">9600</span>);
}

<span class="hljs-keyword">void</span> <span class="hljs-built_in">loop</span>() {
  data = mySerial.<span class="hljs-built_in">read</span>();

  <span class="hljs-built_in">if</span> (data == <span class="hljs-string">'1'</span>) {
    <span class="hljs-built_in">digitalWrite</span>(ledPin, <span class="hljs-literal">HIGH</span>);
    LCD.<span class="hljs-built_in">setCursor</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);
    LCD.<span class="hljs-built_in">print</span>(<span class="hljs-string">"Nice to meet you"</span>);
   }
    <span class="hljs-built_in">else</span> {
 <span class="hljs-built_in">digitalWrite</span>(ledPin, <span class="hljs-literal">LOW</span>);
 LCD.<span class="hljs-built_in">setCursor</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);
 LCD.<span class="hljs-built_in">print</span>(<span class="hljs-string">"                "</span>);


  }
  <span class="hljs-built_in">delay</span>(<span class="hljs-number">100</span>);
}</code></pre><center><img src="img/w15/n.lcd.jpeg" width= "800"/></center>



<p>Final testing of my code </p>
<p><video width="720" height="420" controls="">
           <source src="gif/w15/network.lcd.mp4" type="video/mp4">
           Your browser does not support the video tag.
           </video>
<br><br></p>
<h4 id="files"><a class="header-link" href="#files"></a>Files</h4>
<ul class="list">
<li><p><a href="file/w15/master.ino">Master.ino</a></p>
</li>
<li><p><a href="file/w15/clone.ino">clone.ino</a></p>
</li>
</ul>
<h3 id="asynchronus"><a class="header-link" href="#asynchronus"></a>Asynchronus</h3>
<p>After all these work,to get more  familiar with the concepts of networking I used Neilâ€™s serial Communication examples. This uses attity 45 chip. I use the pins connected to isp as the trasmitter(tx) and receiver(rx) pins too, so that I can use the ISP pins for communications between the boards. SCK and MISo are used as as tx and rx. I wanted to add resonator but couldnt.</p>
<center><img src="img/w15/n1.jpeg" width= "800"/></center>


<p>There are two board here, the bridge and the node. The bridge connects the computer to the network of microcontrollers through ftdi cable. The node is connected to the bridge through ISP cable. It shares many pins but tx and rx are important. I created one of each.</p>
<center><img src="img/w15/n2.jpeg" width= "800"/></center>


<p><br><br></p>
<p>I uploaded the program with node id hardcoded to identify wach board.</p>
<p><br><br></p>
<p>For bridge
<br><br></p>
<pre class="hljs"><code><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> node_id <span class="hljs-string">'0'</span></span></code></pre><p><br><br></p>
<p>For nodes</p>
<pre class="hljs"><code><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> node_id <span class="hljs-string">'1'</span></span></code></pre><p><br><br></p>
<center><img src="img/w15/n3.png" width= "800"/></center>
<br><br>

<center><img src="img/w15/n4.png" width= "800"/></center>


<p><br><br></p>
<p>On sending a either 0 or 1 from the serial FTDI the bridge or the node react to it and output message identifying themselves by their node id.</p>
<p>Then I make the make file:
<br><br></p>
<p><code>sudo make -f hello.bus.45make</code>
<br><br></p>
<center><img src="img/w15/n6.png" width= "600"/></center>
<br><br>

<center><img src="img/w15/n7.png" width= "600"/></center>
<br><br>

<code>sudo make -f hello.bus.45make program-usbtiny</code>
<br><br>

<center><img src="img/w15/n9.png" width= "800"/></center>

<p><br><br></p>
<p>Here the Neil&#39;s python program for controll the node. use this code
<br><br></p>
<p><code>sudo python trym.py /dev/ttyUSB0 9600</code></p>
<p><br><br></p>
<center><img src="img/w15/n11.png" width= "600"/></center>

<p>The interface like this. but the output not exact. will check it and fix later.</p>
<center><img src="img/w15/n12.png" width= "600"/></center>

<p><br><br></p>
<p><video width="720" height="420" controls="">
           <source src="gif/w15/network.mp4" type="video/mp4">
           Your browser does not support the video tag.
           </video>
<br><br></p>
<h4 id="files-1"><a class="header-link" href="#files-1"></a>Files</h4>
<ul class="list">
<li>atf.bus.45.bridge <a href="file/w15/hello.bus.45/atf.bus.45.bridge.cad">cad</a>, <a href="file/w15/hello.bus.45/atf.bus.45.bridge.png">Board</a>, <a href="file/w15/hello.bus.45/atf.bus.45.bridge.traces.png">traces</a>, <a href="file/w15/hello.bus.45/atf.bus.45.bridge.interior.png">interior</a></li>
<li>atf.bus.45.node <a href="file/w15/hello.bus.45/atf.bus.45.node.cad">cad</a>, <a href="file/w15/hello.bus.45/atf.bus.45.node.png">Board</a>, <a href="file/w15/hello.bus.45/atf.bus.45.node.traces.png">traces</a>, <a href="file/w15/hello.bus.45/atf.bus.45.node.interior.png">interior</a></li>
<li><a href="file/w15/hello.bus.45/hello.bus.45.make">make</a>, <a href="file/w15/hello.bus.45/hello.bus.45.c">c</a></li>
<li><a href="file/w15/hello.bus.45/term.py">term.py</a></li>
</ul>
<hr>
<p>If you need to commumicate with multiple microcontrol its a good chioce to keep in Arduino program then as Master and slaves.
<br><br></p>
<p>Master:
<br><br></p>
<pre class="hljs"><code>void <span class="hljs-keyword">loop</span>() {
    update_ramps()
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span><span class="hljs-comment">; i&lt; num_slaves; i++) {</span>
        send_to_all(i, ramps[i])<span class="hljs-comment">;</span></code></pre><p><br><br></p>
<p>Slave 1:
<br><br></p>
<pre class="hljs"><code>const <span class="hljs-keyword">int</span> id = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
<span class="hljs-keyword">int</span> recived_id, recived_value<span class="hljs-comment">;</span>
void <span class="hljs-keyword">loop</span>() {
    read_data()<span class="hljs-comment">;</span>
    <span class="hljs-keyword">if</span>(recived_id == id) { 
        do_motor_step(recived_value)<span class="hljs-comment">;</span>
    }
}</code></pre><p><br><br></p>
<p>And serial communication in which RX/TX from the master is sent to all slaves.
<br><br></p>
<hr>
<h2 id="spi"><a class="header-link" href="#spi"></a>SPI</h2>
<p>SPI also uses shared lines for data: a single MOSI, and the MISO lines connected. To address each slave individually you&#39;ll need one SS (Slave Select) line per slave. So that&#39;s at least 5 I/Os: MOSI, SCK, 3 Ã—Ã— SS, and MISO if you also want to read data from the slaves. Each additional slave adds 1 I/O pin on the master.</p>
<p><br><br></p>
<center><img src="img/w15/spi.png" width= "600"/></center>

<p><br><br></p>
<p>I  used design a board using kokopeli which wireless data tranfer.After stuffing the board i did burn bootloader which got sucess,but during programming it did not work,Actually this board is for my project ,but i didi skip that plan due to lack of time.</p>
<center><img src="img/w15/mecduino.png" width= "800"/></center>

<p><br><br></p>
<ul class="list">
<li><a href="img/w15/mecduino.cad">Mecduino.cad</a></li>
<li><a href="img/w15/mecduino.png">Mecduino.png</a></li>
<li><a href="img/w15/mecduino.traces.png">Mecduino.traces</a></li>
<li><a href="img/w15/mecduino.interior.png">Mecduino.interior</a></li>
<li><a href="img/w15/mecduino.holes.png">Mecduino.holes</a></li>
</ul>
<h3 id="mrf89xa"><a class="header-link" href="#mrf89xa"></a>MRF89XA</h3>
<p>I designed differnt board for  MRF89XA using kokopelli. For placing in all micro control.</p>
<center><img src="file/w15/MRF89XA/MRF89XA.png" width= "400"/></center>

<p><br><br></p>
<center><img src="img/w15/mrf1.jpeg" width= "800"/></center>
<br><br>
<center><img src="img/w15/mrf2.jpeg" width= "800"/></center>



<p><br><br></p>
<ul class="list">
<li>MRF89XA <a href="file/w15/MRF89XA/MRF89XAM9A.pdf">Datasheet</a></li>
<li><a href="file/w15/MRF89XA/MRF89XA.png">MRF89XA Board</a></li>
<li><a href="file/w15/MRF89XA/MRF89XA.traces.png">MRF89XA traces</a></li>
<li><a href="file/w15/MRF89XA/MRF89XA.interior.png">MRF89XA interior</a></li>
</ul>
<hr>
      </div>
    </div>
  </div>

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript" src="assets/js/bootstrap.min.js"></script>
</body>
</html>
