<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>week-16</title>
    <link type="text/css" rel="stylesheet" href="assets/css/bootstrap.css"/>
    <link type="text/css" rel="stylesheet" href="assets/css/bootstrap-responsive.css"/>
    <link type="text/css" rel="stylesheet" href="assets/css/pilcrow.css"/>
    <link type="text/css" rel="stylesheet" href="assets/css/hljs-github.min.css"/>
    <link type="text/css" rel="stylesheet" href="assets/css/style.css"/>
    <style>
    body {
      background: url('assets/img/textured_paper.png') repeat top left;
      background-color: #f6f6f6;
    }
    </style>
  </head>
<body>

  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span3"><ul class="nav nav-list">
    <li class="sidebar-header-1"><a href="#week-16-interface-and-application-programming-may-18-">Week 16 : Interface and application programming (May 18)</a></li>
    <li class="sidebar-header-2"><a href="#assignment-">Assignment:</a></li>
    <li class="sidebar-header-2"><a href="#ubuntu-terminal-interface-with-lcd">Ubuntu terminal interface with LCD</a></li>
    <li class="sidebar-header-2"><a href="#interface-with-ulrasonic-sensor">Interface With Ulrasonic sensor</a></li>
    <li class="sidebar-header-2"><a href="#files">Files</a></li>
</ul>
      </div>
      <div class="span9 main"><h1 id="week-16-interface-and-application-programming-may-18-"><a class="header-link" href="#week-16-interface-and-application-programming-may-18-"></a>Week 16 : Interface and application programming (May 18)</h1>
<h2 id="assignment-"><a class="header-link" href="#assignment-"></a>Assignment:</h2>
<p>This week assignemt is to write an application that interface with an Input or Output device I&#39;ve made as well as to compare as many tool options as possible.</p>
<hr>
<h2 id="ubuntu-terminal-interface-with-lcd"><a class="header-link" href="#ubuntu-terminal-interface-with-lcd"></a>Ubuntu terminal interface with LCD</h2>
<p>I wish to interface my ubuntu terminal with my output device LCD board which I made during output week. I used python program for creating my interface application.<a href="http://learnpythonthehardway.org/book/">http://learnpythonthehardway.org/book/</a>  is the best online site for learning the python language.</p>
<p>First I refered the pyhton program that interface with ubuntu terminal. then I started to create the interface app.</p>
<pre class="hljs"><code><span class="hljs-keyword">import</span> serial
<span class="hljs-keyword">import</span> <span class="hljs-built_in">time</span>

s = serial.Serial(<span class="hljs-string">'/dev/ttyUSB0'</span>, <span class="hljs-number">9600</span>) #port <span class="hljs-keyword">is</span> /dev/ttyUSB0, <span class="hljs-built_in">and</span> baud rate <span class="hljs-keyword">is</span> <span class="hljs-number">9600</span>
<span class="hljs-built_in">time</span>.sleep(<span class="hljs-number">2</span>)    #wait <span class="hljs-keyword">for</span> the Serial to initialize
s.write(<span class="hljs-string">'Ready...'</span>)
<span class="hljs-keyword">while</span> True:
    str = raw_input(<span class="hljs-string">'Enter text: '</span>)
    str = str.strip()
    <span class="hljs-keyword">if</span> str == <span class="hljs-string">'exit'</span> :
        break
    s.write(str)</code></pre><p>Then i tried to run the program. But it was&#39;t. Searched on online and got some solution. Confirm wheater npm,websocket,serialport installed or not. here the commends.</p>
<p><code>sudo apt install npm</code></p>
<p><code>sudo npm install websocket</code></p>
<p><code>sudo npm --websocket:verbose --nodedir=/home/ubuntu/node install -g websocket</code></p>
<p><code>sudo npm --websocket:verbose --nodedir=/home/ubuntu/node-v0.10.32 install -g websocket</code></p>
<p><code>npm install serialport</code></p>
<p>Install Minicom </p>
<p>Minicom is a text-based serial port communications program. It is used to talk to external RS-232 devices such as mobile phones, routers, and serial console ports. </p>
<p><code>sudo apt-get install minicom</code></p>
<p><code>dmesg | grep tty</code></p>
<p>Again I run  the progrm. Same problem.. I recheked it again. At last found the serial port name changed, Corrected it into <code>dev/ttyUSB0</code> and again restarted the program..</p>
<video width="720" height="420" controls="">
           <source src="gif/w16/test.interface.mp4" type="video/mp4">
           Your browser does not support the video tag.
           </video>





<hr>
<p>I programmed the the board which i made during output week. Using Arduino IDE I upload the program to Attiny 44. Declare the LCD pins are 5,4,3,2,1,0 and the Rx, TX pins are 6,7.</p>
<pre class="hljs"><code><span class="hljs-comment">// include the library code:</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;LiquidCrystal.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SoftwareSerial.h&gt;</span></span>
<span class="hljs-built_in">SoftwareSerial</span> mySerial(<span class="hljs-number">6</span>,<span class="hljs-number">7</span>);

<span class="hljs-comment">// initialize the library with the numbers of the interface pins</span>
<span class="hljs-built_in">LiquidCrystal</span> lcd(<span class="hljs-number">5</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);

<span class="hljs-keyword">void</span> <span class="hljs-built_in">setup</span>() {
  mySerial.<span class="hljs-built_in">begin</span>(<span class="hljs-number">9600</span>);
  lcd.<span class="hljs-built_in">begin</span>(<span class="hljs-number">16</span>, <span class="hljs-number">2</span>);
  lcd.<span class="hljs-built_in">print</span>(<span class="hljs-string">"start"</span>);
}

<span class="hljs-keyword">void</span> <span class="hljs-built_in">loop</span>() {
  <span class="hljs-built_in">if</span> (mySerial.<span class="hljs-built_in">available</span>()) {
    <span class="hljs-built_in">delay</span>(<span class="hljs-number">100</span>);  <span class="hljs-comment">//wait some time for the data to fully be read</span>
    lcd.<span class="hljs-built_in">clear</span>();
    <span class="hljs-built_in">while</span> (mySerial.<span class="hljs-built_in">available</span>() &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">char</span> c = mySerial.<span class="hljs-built_in">read</span>();
      lcd.<span class="hljs-built_in">write</span>(c);
    }
  }
}</code></pre><p>Then I connected the LCD board  and again run it. checke the output. Some of the letters connot display on the LCD.</p>
<video width="720" height="420" controls="">
           <source src="gif/w16/interface1.mp4" type="video/mp4">
           Your browser does not support the video tag.
           </video>



<hr>
<h2 id="interface-with-ulrasonic-sensor"><a class="header-link" href="#interface-with-ulrasonic-sensor"></a>Interface With Ulrasonic sensor</h2>
<p>Then I tried to create Python program for Printing the measured diatance value using HC-05 Sonar sensor. Also I added two Switch control options. There I am goin to place each LEDs. I want to print the measured distance in inches and in centimeters. I created the python refering the previous students.</p>
<pre class="hljs"><code><span class="hljs-keyword">from</span> Tkinter import * <span class="hljs-comment"># Import tk module</span>
import tkFont
import serial
import time

arduino=serial.Serial() <span class="hljs-comment">#Serial comunication with fabKit (Arduino UNO compatible)</span>
arduino.<span class="hljs-keyword">port</span> =<span class="hljs-string">"/dev/ttyUSB0"</span> <span class="hljs-comment">#Change this value for your COM / tty</span>
arduino.baudrate = <span class="hljs-number">9600</span> <span class="hljs-comment">#comunication to 9600 bauds</span>

arduino.open()

def sendOrder(order):
     vf['text']=<span class="hljs-string">"Waiting response..."</span>
     v0.update_idletasks()
     arduino.flushInput()
     arduino.flushOutput()
     arduino.write(order+<span class="hljs-string">"\r\n"</span>)

     if arduino.readline()==<span class="hljs-string">"OKI\r\n"</span>: <span class="hljs-comment"># "OKI\r\n" is the default response of fabkit program</span>

         if order==<span class="hljs-string">"b"</span>:
             v2['text']=<span class="hljs-string">"State Output 2: ON"</span>
             v2['bg']=<span class="hljs-string">"green"</span>
         elif order==<span class="hljs-string">"a"</span>:
             v2['text']=<span class="hljs-string">"State Output 2: OFF"</span>
             v2['bg']=<span class="hljs-string">"red"</span>
         elif order==<span class="hljs-string">"d"</span>:
             v1['text']=<span class="hljs-string">"State Output 1: ON"</span>
             v1['bg']=<span class="hljs-string">"green"</span>
         elif order==<span class="hljs-string">"c"</span>:
             v1['text']=<span class="hljs-string">"State Output 1: OFF"</span>
             v1['bg']=<span class="hljs-string">"red"</span>
         elif order==<span class="hljs-string">"e"</span>:
             t1['text']=<span class="hljs-string">"Distance:  "</span>+arduino.readline().rstrip() + <span class="hljs-string">" inches"</span>
         elif order==<span class="hljs-string">"f"</span>:
             h1['text']=<span class="hljs-string">"Distance:  "</span>+arduino.readline().rstrip() + <span class="hljs-string">" centimeters"</span>
     vf['text']=<span class="hljs-string">""</span>

print (<span class="hljs-string">"Athif interface- Fab academy 2016"</span>) <span class="hljs-comment"># Say hello in console (for debug, you can erase)</span>
v0 = Tk() <span class="hljs-comment"># Tk() Main window</span>
v0.wm_title(<span class="hljs-string">"Athif Fab Academy - Interface and Application Programming"</span>)
<span class="hljs-comment">#v0.config(bg="black") # if you need change background color</span>
v0.geometry(<span class="hljs-string">"800x400"</span>) <span class="hljs-comment"># windows size for aplication</span>

helv16 = tkFont.Font(family=<span class="hljs-string">"Helvetica"</span>,size=<span class="hljs-number">16</span>,weight=<span class="hljs-string">"bold"</span>)
helv24 = tkFont.Font(family=<span class="hljs-string">"Helvetica"</span>,size=<span class="hljs-number">24</span>,weight=<span class="hljs-string">"bold"</span>)
helv14 = tkFont.Font(family=<span class="hljs-string">"Helvetica"</span>,size=<span class="hljs-number">14</span>,weight=<span class="hljs-string">"bold"</span>)
helv8 = tkFont.Font(family=<span class="hljs-string">"Helvetica"</span>,size=<span class="hljs-number">8</span>,weight=<span class="hljs-string">"bold"</span>)
l = Label(v0,font=helv16,text=<span class="hljs-string">"Athif Fab Academy - Interface and Application Programming"</span>)
l.place(relx=.<span class="hljs-number">5</span>, rely=.<span class="hljs-number">1</span>, <span class="hljs-built_in">anchor</span>=<span class="hljs-string">"c"</span>)

v1 = Label(v0,font=helv14,text=<span class="hljs-string">"State Output 1: OFF"</span>,bg=<span class="hljs-string">"red"</span>)
v1.place(relx=.<span class="hljs-number">2</span>, rely=.<span class="hljs-number">35</span>, <span class="hljs-built_in">anchor</span>=<span class="hljs-string">"c"</span>)
v2 = Label(v0,font=helv14,text=<span class="hljs-string">"State Output 2: OFF"</span>,bg=<span class="hljs-string">"red"</span>)
v2.place(relx=.<span class="hljs-number">2</span>, rely=.<span class="hljs-number">45</span>, <span class="hljs-built_in">anchor</span>=<span class="hljs-string">"c"</span>)
t1 = Label(v0,font=helv14,text=<span class="hljs-string">"Distance in inches: --"</span>)
t1.place(relx=.<span class="hljs-number">2</span>, rely=.<span class="hljs-number">53</span>, <span class="hljs-built_in">anchor</span>=<span class="hljs-string">"c"</span>)
h1 = Label(v0,font=helv14,text=<span class="hljs-string">"Distance in centimeters: --"</span>)
h1.place(relx=.<span class="hljs-number">2</span>, rely=.<span class="hljs-number">60</span>, <span class="hljs-built_in">anchor</span>=<span class="hljs-string">"c"</span>)
b1=Button(v0,text=<span class="hljs-string">"Activate output 1"</span>,width=<span class="hljs-number">20</span>,command=lambda: sendOrder('d'))
b1.place(relx=.<span class="hljs-number">5</span>, rely=.<span class="hljs-number">35</span>, <span class="hljs-built_in">anchor</span>=<span class="hljs-string">"c"</span>)
<span class="hljs-comment">#b1['text']="test"</span>
b2=Button(v0,text=<span class="hljs-string">"Disable output 1"</span>,width=<span class="hljs-number">20</span>,command=lambda: sendOrder(<span class="hljs-string">"c"</span>))
b2.place(relx=.<span class="hljs-number">8</span>, rely=.<span class="hljs-number">35</span>, <span class="hljs-built_in">anchor</span>=<span class="hljs-string">"c"</span>)

b3=Button(v0,text=<span class="hljs-string">"Activate output 2"</span>,width=<span class="hljs-number">20</span>,command=lambda: sendOrder(<span class="hljs-string">"b"</span>))
b3.place(relx=.<span class="hljs-number">5</span>, rely=.<span class="hljs-number">45</span>, <span class="hljs-built_in">anchor</span>=<span class="hljs-string">"c"</span>)
<span class="hljs-comment">#b1['text']="test"</span>
b4=Button(v0,text=<span class="hljs-string">"Disable output 2"</span>,width=<span class="hljs-number">20</span>,command=lambda: sendOrder(<span class="hljs-string">"a"</span>))
b4.place(relx=.<span class="hljs-number">8</span>, rely=.<span class="hljs-number">45</span>, <span class="hljs-built_in">anchor</span>=<span class="hljs-string">"c"</span>)

b5=Button(v0,text=<span class="hljs-string">"Update Distance"</span>,width=<span class="hljs-number">20</span>,command=lambda: sendOrder(<span class="hljs-string">"e"</span>))
b5.place(relx=.<span class="hljs-number">8</span>, rely=.<span class="hljs-number">53</span>, <span class="hljs-built_in">anchor</span>=<span class="hljs-string">"c"</span>)

b6=Button(v0,text=<span class="hljs-string">"Update Distance"</span>,width=<span class="hljs-number">20</span>,command=lambda: sendOrder(<span class="hljs-string">"f"</span>))
b6.place(relx=.<span class="hljs-number">8</span>, rely=.<span class="hljs-number">60</span>, <span class="hljs-built_in">anchor</span>=<span class="hljs-string">"c"</span>)

vf = Label(v0,font=helv8,text=<span class="hljs-string">"Waiting response..."</span>)
vf .place(relx=.<span class="hljs-number">5</span>, rely=.<span class="hljs-number">97</span>, <span class="hljs-built_in">anchor</span>=<span class="hljs-string">"c"</span>)
vf['text']=<span class="hljs-string">""</span>
v0.mainloop() <span class="hljs-comment"># launch the main window</span></code></pre><p>Oped the program and tested the interfaces. Its oke..</p>
<video width="720" height="420" controls="">
           <source src="gif/w16/atf.interface.ogv" type="video/ogg">
           Your browser does not support the video tag.
           </video>

<p>Then created the Arduino program. which actaully is a modification of LCD print. Added 6 cases for reading each operations.</p>
<pre class="hljs"><code><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;SoftwareSerial.h&gt;</span></span>
<span class="hljs-built_in">SoftwareSerial</span> mySerial(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> trigPin = <span class="hljs-number">7</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> echoPin = <span class="hljs-number">6</span>;

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PIN1 4</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PIN2 5</span>

<span class="hljs-keyword">void</span> <span class="hljs-built_in">setup</span>() {
 mySerial.<span class="hljs-built_in">begin</span>(<span class="hljs-number">9600</span>);
 <span class="hljs-built_in">pinMode</span>(PIN1,<span class="hljs-literal">OUTPUT</span>);
 <span class="hljs-built_in">pinMode</span>(PIN2,<span class="hljs-literal">OUTPUT</span>);
 <span class="hljs-built_in">digitalWrite</span>(PIN1,<span class="hljs-literal">LOW</span>);
   <span class="hljs-built_in">digitalWrite</span>(PIN2,<span class="hljs-literal">LOW</span>);
}

<span class="hljs-keyword">void</span> <span class="hljs-built_in">loop</span>()
{

  <span class="hljs-keyword">long</span> duration, inches, cm;
  <span class="hljs-built_in">pinMode</span>(trigPin, <span class="hljs-literal">OUTPUT</span>);
  <span class="hljs-built_in">digitalWrite</span>(trigPin, <span class="hljs-literal">LOW</span>);
  <span class="hljs-built_in">delayMicroseconds</span>(<span class="hljs-number">2</span>);
  <span class="hljs-built_in">digitalWrite</span>(trigPin, <span class="hljs-literal">HIGH</span>);
  <span class="hljs-built_in">delayMicroseconds</span>(<span class="hljs-number">10</span>);
  <span class="hljs-built_in">digitalWrite</span>(trigPin, <span class="hljs-literal">LOW</span>);

  <span class="hljs-built_in">pinMode</span>(echoPin, <span class="hljs-literal">INPUT</span>);
  duration = <span class="hljs-built_in">pulseIn</span>(echoPin, <span class="hljs-literal">HIGH</span>);

  inches = microsecondsToInches(duration);
  cm = microsecondsToCentimeters(duration);
  <span class="hljs-built_in">delay</span> (<span class="hljs-number">100</span>);
   <span class="hljs-built_in">if</span>(mySerial.<span class="hljs-built_in">available</span>()&gt;<span class="hljs-number">0</span>)
   {
     <span class="hljs-built_in">switch</span>(mySerial.<span class="hljs-built_in">read</span>())
     {
       <span class="hljs-built_in">case</span> <span class="hljs-string">'b'</span>:
         mySerial.<span class="hljs-built_in">println</span>(<span class="hljs-string">"OKI"</span>);
         <span class="hljs-built_in">digitalWrite</span>(PIN1,<span class="hljs-literal">HIGH</span>);
         <span class="hljs-built_in">break</span>;
       <span class="hljs-built_in">case</span> <span class="hljs-string">'a'</span>:
         mySerial.<span class="hljs-built_in">println</span>(<span class="hljs-string">"OKI"</span>);
         <span class="hljs-built_in">digitalWrite</span>(PIN1,<span class="hljs-literal">LOW</span>);
         <span class="hljs-built_in">break</span>;
       <span class="hljs-built_in">case</span> <span class="hljs-string">'c'</span>:
         mySerial.<span class="hljs-built_in">println</span>(<span class="hljs-string">"OKI"</span>);
         <span class="hljs-built_in">digitalWrite</span>(PIN2,<span class="hljs-literal">LOW</span>);
         <span class="hljs-built_in">break</span>;
       <span class="hljs-built_in">case</span> <span class="hljs-string">'d'</span>:
         mySerial.<span class="hljs-built_in">println</span>(<span class="hljs-string">"OKI"</span>);
         <span class="hljs-built_in">digitalWrite</span>(PIN2,<span class="hljs-literal">HIGH</span>);
         <span class="hljs-built_in">break</span>;
       <span class="hljs-built_in">case</span> <span class="hljs-string">'e'</span>:
         mySerial.<span class="hljs-built_in">println</span>(<span class="hljs-string">"OKI"</span>);
         mySerial.<span class="hljs-built_in">print</span>(inches);
         mySerial.<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span>);
         <span class="hljs-built_in">break</span>;
       <span class="hljs-built_in">case</span> <span class="hljs-string">'f'</span>:
         mySerial.<span class="hljs-built_in">println</span>(<span class="hljs-string">"OKI"</span>);
         mySerial.<span class="hljs-built_in">print</span>(cm);
         mySerial.<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span>);
         <span class="hljs-built_in">break</span>;

       <span class="hljs-built_in">default</span>: mySerial.<span class="hljs-built_in">println</span>(<span class="hljs-string">"?"</span>);
     }
   }
}
<span class="hljs-keyword">long</span> microsecondsToInches(<span class="hljs-keyword">long</span> microseconds)
{
  <span class="hljs-comment">// According to Parallax's datasheet for the PING))), there are</span>
  <span class="hljs-comment">// 73.746 microseconds per inch (i.e. sound travels at 1130 feet per</span>
  <span class="hljs-comment">// second).  This gives the distance travelled by the ping, outbound</span>
  <span class="hljs-comment">// and return, so we divide by 2 to get the distance of the obstacle.</span>
  <span class="hljs-comment">// See: http://www.parallax.com/dl/docs/prod/acc/28015-PING-v1.3.pdf</span>
  <span class="hljs-built_in">return</span> microseconds / <span class="hljs-number">74</span> / <span class="hljs-number">2</span>;
}
<span class="hljs-keyword">long</span> microsecondsToCentimeters(<span class="hljs-keyword">long</span> microseconds)
{
  <span class="hljs-comment">// The speed of sound is 340 m/s or 29 microseconds per centimeter.</span>
  <span class="hljs-comment">// The ping travels out and back, so to find the distance of the</span>
  <span class="hljs-comment">// object we take half of the distance travelled.</span>
  <span class="hljs-built_in">return</span> microseconds /<span class="hljs-number">29</span> / <span class="hljs-number">2</span>;
}</code></pre><p>Compalied it and uploaded the program to the input board. Run the python program and tested it.. it almost okay..</p>
<video width="720" height="420" controls="">
           <source src="gif/w16/interface.mp4" type="video/mp4">
           Your browser does not support the video tag.
           </video>



<hr>
<h2 id="files"><a class="header-link" href="#files"></a>Files</h2>
<ul class="list">
<li><p>Ubuntu terminal interface with LCD,<a href="file/w16/py.lcd.interface.ino">py.lcd.interface.ino</a>,<a href="file/w16/py.lcd.interface.py">py.lcd.interface.py</a></p>
</li>
<li><p>Interface With Ulrasonic sensor,<a href="file/w16/HC05.LED.python.interface.ino">HC05.LED.python.interface.ino</a>,<a href="file/w16/HC05.LED.python.interface.py">HC05.LED.python.interface.py</a></p>
</li>
</ul>
      </div>
    </div>
  </div>

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script type="text/javascript" src="assets/js/bootstrap.min.js"></script>
</body>
</html>
